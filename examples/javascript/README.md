# JavaScript + Versionator Example

This example demonstrates how to integrate versionator with a JavaScript/Node.js project.

## Approach

For interpreted languages like JavaScript, use `versionator emit` to generate a version file at build time.

### How It Works

1. `VERSION` file contains the version (managed by versionator)
2. At build time, run `versionator emit js -o src/version.js`
3. JavaScript code imports the generated version module

## Files

```
examples/javascript/
├── src/
│   ├── index.js          # Main application (imports version)
│   ├── version.js        # Generated by versionator (git-ignored)
│   └── version.tmpl.js   # Optional: custom template
├── package.json          # NPM package config
├── Makefile              # Make targets
├── justfile              # Just targets
└── README.md
```

## Usage

### Using Make

```bash
# Create VERSION file (in project root)
echo "1.0.0" > ../../VERSION

# Generate version.js and run
make run

# Clean generated files
make clean
```

### Using Just

```bash
# Generate version.js and run
just run

# Bump version and rebuild
just release-patch
```

### Using npm scripts

```bash
# Generate version.js and run (uses npm scripts)
npm start

# Just generate version.js
npm run version
```

## Generated Output

`versionator emit js` generates:

```javascript
// Auto-generated by versionator 1.0.0. Do not edit.
export const VERSION = "1.2.3";
export default VERSION;
```

## Custom Template

Create `src/version.tmpl.js`:

```javascript
// Auto-generated by versionator {{.VersionatorVersion}}. Do not edit.
export const VERSION = "{{.Version}}";
export const BUILD_INFO = {
    version: "{{.Version}}",
    generator: "versionator {{.VersionatorVersion}}"
};
export default VERSION;
```

Then generate with:

```bash
versionator emit --template-file src/version.tmpl.js --output src/version.js
```

## CommonJS Support

For CommonJS projects, use a custom template:

```javascript
// version.cjs.tmpl
// Auto-generated by versionator {{.VersionatorVersion}}. Do not edit.
module.exports = {
    VERSION: "{{.Version}}"
};
```

## CI/CD Integration

### GitHub Actions

```yaml
- name: Generate version and build
  run: |
    versionator emit js --output src/version.js
    npm ci
    npm run build

- name: Publish to npm
  run: npm publish
  env:
    NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
```

## Syncing package.json version

To keep `package.json` version in sync:

```bash
# Update package.json version field
VERSION=$(versionator version)
npm version $VERSION --no-git-tag-version
```

Or use a custom template that generates a script to update package.json.

## Best Practices

1. Add `src/version.js` to `.gitignore`
2. Generate version file in CI/CD before building
3. Use `versionator commit` to create git tags after releases
4. Consider generating both ESM and CommonJS versions if needed
