# Ruby + Versionator Example

This example demonstrates how to integrate versionator with a Ruby gem.

## Approach

For interpreted languages like Ruby, use `versionator emit` to generate a version file at build time.

### How It Works

1. `VERSION` file contains the version (managed by versionator)
2. At build time, run `versionator emit ruby -o lib/mypackage/version.rb`
3. Ruby code requires the generated version file
4. The gemspec reads version from the module constant

## Files

```
examples/ruby/
├── bin/
│   └── mypackage           # Executable
├── lib/
│   ├── mypackage.rb        # Main module
│   └── mypackage/
│       ├── version.rb      # Generated by versionator (git-ignored)
│       └── version.rb.tmpl # Optional: custom template
├── mypackage.gemspec       # Gem specification
├── Gemfile                 # Dependencies
├── Rakefile                # Rake tasks
├── Makefile                # Make targets
├── justfile                # Just targets
└── README.md
```

## Usage

### Using Make

```bash
# Create VERSION file (in project root)
echo "1.0.0" > ../../VERSION

# Generate version.rb and build
make build

# Run the application
make run

# Clean generated files
make clean
```

### Using Just

```bash
# Generate version.rb and build
just build

# Run the application
just run

# Bump version and rebuild
just release-patch
```

### Using Rake

```bash
# Generate version.rb
rake version

# Build gem (generates version.rb first)
rake build

# Run
rake run
```

## Generated Output

`versionator emit ruby` generates:

```ruby
# frozen_string_literal: true
# Auto-generated by versionator. Do not edit.

module Mypackage
  VERSION = "1.0.0"
end
```

## Custom Template

Create `lib/mypackage/version.rb.tmpl`:

```ruby
# frozen_string_literal: true
# Custom version file

module Mypackage
  VERSION = "{{.Version}}"
  BUILD_DATE = "2024-01-01"
end
```

Then generate with:

```bash
versionator emit --template-file lib/mypackage/version.rb.tmpl --output lib/mypackage/version.rb
```

## CI/CD Integration

### GitHub Actions

```yaml
- name: Build Ruby gem
  run: |
    versionator emit ruby --output lib/mypackage/version.rb
    gem build mypackage.gemspec

- name: Publish to RubyGems
  run: gem push mypackage-*.gem
  env:
    GEM_HOST_API_KEY: ${{ secrets.RUBYGEMS_API_KEY }}
```

## Best Practices

1. Add `lib/mypackage/version.rb` to `.gitignore`
2. Keep `version.rb.tmpl` in source control if using custom template
3. Generate version file in CI/CD before building
4. Use `versionator commit` to create git tags after releases
