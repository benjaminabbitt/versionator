# Go Plugin

The golang plugin provides versionator support for Go projects.

## Overview

Go projects typically use semantic versioning with a `v` prefix (e.g., `v1.2.3`). Go modules derive version from git tags, but applications often need version information at runtime.

## Injection Methods

| Method | Description |
|--------|-------------|
| `emit` | Generate `version.go` with version constants |
| `link` | Generate `-ldflags` for compile-time injection |

### Emit

Generate a Go source file with version constants:

```bash
versionator emit go
# Creates internal/version/version.go
```

Generated file:

```go
// Code generated by versionator. DO NOT EDIT.
package version

const (
    Version     = "1.2.3"
    Major       = 1
    Minor       = 2
    Patch       = 3
    PreRelease  = ""
    Metadata    = ""
    GitHash     = "abc1234"
    GitBranch   = "main"
    BuildDate   = "2024-01-15"
)
```

Usage:

```go
import "myapp/internal/version"

fmt.Printf("Version: %s\n", version.Version)
```

### Link (ldflags)

Inject version at compile time without generating files:

```bash
# Get ldflags
versionator emit build go
# Output: -X main.Version=1.2.3

# Use with go build
go build -ldflags "$(versionator emit build go)" -o app .
```

Usage in your code:

```go
package main

var Version = "dev" // Overridden at build time

func main() {
    fmt.Printf("Version: %s\n", Version)
}
```

### Custom Variable Path

Override the default variable path:

```bash
versionator emit build go --var myapp/internal/buildinfo.Version
# Output: -X myapp/internal/buildinfo.Version=1.2.3
```

## Build System Integration

### Makefile

```makefile
VERSION := $(shell versionator version)
LDFLAGS := -X main.Version=$(VERSION)

build:
	go build -ldflags "$(LDFLAGS)" -o app .
```

### justfile

```just
build:
    #!/bin/bash
    VERSION=$(versionator version)
    go build -ldflags "-X main.Version=$VERSION" -o app .
```

### CI/CD (GitHub Actions)

```yaml
- name: Build
  run: |
    VERSION=$(versionator version)
    go build -ldflags "-X main.Version=$VERSION" -o app .
```

## Go Module Versioning

For Go modules, version is derived from git tags. Use versionator with `commit`:

```bash
# Bump version
versionator patch increment

# Create git tag
versionator commit
# Creates tag v1.2.4

# Push tag
git push --tags
```

## Configuration

Default output path: `internal/version/version.go`
Default package: `version`

Override with:

```bash
versionator emit go --output pkg/version/version.go --package version
```

## See Also

- [rust](../rust/) - Rust projects (similar compiled language workflow)
- Main README section on [Go Projects](../../../README.md#go-projects-pre-release-canonical-use-case)
