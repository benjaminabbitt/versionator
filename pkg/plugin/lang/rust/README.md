# Rust Plugin

The rust plugin provides versionator support for Rust/Cargo projects.

## Overview

Rust projects use `Cargo.toml` for package configuration:

```toml
[package]
name = "myapp"
version = "1.2.3"
```

## Injection Methods

| Method | Description |
|--------|-------------|
| `emit` | Generate `version.rs` with version constants |
| `link` | Generate environment variables for build-time injection |
| `patch` | Update `version` in `Cargo.toml` |

### Emit

Generate a Rust module with version constants:

```bash
versionator emit rust
# Creates src/version.rs
```

Generated file:

```rust
// Auto-generated by versionator. Do not edit.

pub const VERSION: &str = "1.2.3";
pub const MAJOR: u32 = 1;
pub const MINOR: u32 = 2;
pub const PATCH: u32 = 3;
pub const GIT_HASH: &str = "abc1234";
```

Usage in `main.rs` or `lib.rs`:

```rust
mod version;

fn main() {
    println!("Version: {}", version::VERSION);
}
```

### Link (Environment Variables)

Inject version at compile time using Rust's `env!` macro:

```bash
# Get environment variables
versionator emit build rust
# Output: VERSION=1.2.3

# Use with cargo
$(versionator emit build rust) cargo build
```

Usage in your code:

```rust
const VERSION: &str = env!("VERSION");

fn main() {
    println!("Version: {}", VERSION);
}
```

### Patch

Update the version directly in `Cargo.toml`:

```bash
versionator patch rust
```

## Cargo Integration

### Build Script (build.rs)

For dynamic version injection:

```rust
// build.rs
use std::process::Command;

fn main() {
    let output = Command::new("versionator")
        .args(["version"])
        .output()
        .expect("failed to get version");

    let version = String::from_utf8_lossy(&output.stdout);
    println!("cargo:rustc-env=VERSION={}", version.trim());
}
```

### Workspace Projects

For Cargo workspaces, patch each crate's `Cargo.toml`:

```bash
versionator patch rust --file crates/mylib/Cargo.toml
versionator patch rust --file crates/mybin/Cargo.toml
```

## Build System Integration

### Makefile

```makefile
version:
	versionator emit rust --output src/version.rs

build: version
	cargo build --release
```

### CI/CD (GitHub Actions)

```yaml
- name: Update version
  run: |
    versionator patch rust
    versionator emit rust

- name: Build
  run: cargo build --release

- name: Publish to crates.io
  run: cargo publish
```

## Configuration

Default output path: `src/version.rs`

Override with:

```bash
versionator emit rust --output src/info/version.rs
```

## See Also

- [golang](../golang/) - Go projects (similar compiled language workflow)
- [c](../c/) - C projects
- [cpp](../cpp/) - C++ projects
